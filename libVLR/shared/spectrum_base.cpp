#include "spectrum_base.h"
#include "rgb_spectrum_types.h"
#include "spectrum_types.h"

namespace vlr {
    const float xbar_CIE1931_2deg[] = {
        0.0001299f, 0.000145847f, 0.000163802f, 0.000184004f, 0.00020669f, 0.0002321f, 0.000260728f, 0.000293075f,
        0.000329388f, 0.000369914f, 0.0004149f, 0.000464159f, 0.000518986f, 0.000581854f, 0.000655235f, 0.0007416f,
        0.00084503f, 0.000964527f, 0.001094949f, 0.001231154f, 0.001368f, 0.00150205f, 0.001642328f, 0.001802382f,
        0.001995757f, 0.002236f, 0.002535385f, 0.002892603f, 0.003300829f, 0.003753236f, 0.004243f, 0.004762389f,
        0.005330048f, 0.005978712f, 0.006741117f, 0.00765f, 0.008751373f, 0.01002888f, 0.0114217f, 0.01286901f,
        0.01431f, 0.01570443f, 0.01714744f, 0.01878122f, 0.02074801f, 0.02319f, 0.02620736f, 0.02978248f,
        0.03388092f, 0.03846824f, 0.04351f, 0.0489956f, 0.0550226f, 0.0617188f, 0.069212f, 0.07763f,
        0.08695811f, 0.09717672f, 0.1084063f, 0.1207672f, 0.13438f, 0.1493582f, 0.1653957f, 0.1819831f,
        0.198611f, 0.21477f, 0.2301868f, 0.2448797f, 0.2587773f, 0.2718079f, 0.2839f, 0.2949438f,
        0.3048965f, 0.3137873f, 0.3216454f, 0.3285f, 0.3343513f, 0.3392101f, 0.3431213f, 0.3461296f,
        0.34828f, 0.3495999f, 0.3501474f, 0.350013f, 0.349287f, 0.34806f, 0.3463733f, 0.3442624f,
        0.3418088f, 0.3390941f, 0.3362f, 0.3331977f, 0.3300411f, 0.3266357f, 0.3228868f, 0.3187f,
        0.3140251f, 0.308884f, 0.3032904f, 0.2972579f, 0.2908f, 0.2839701f, 0.2767214f, 0.2689178f,
        0.2604227f, 0.2511f, 0.2408475f, 0.2298512f, 0.2184072f, 0.2068115f, 0.19536f, 0.1842136f,
        0.1733273f, 0.1626881f, 0.1522833f, 0.1421f, 0.1321786f, 0.1225696f, 0.1132752f, 0.1042979f,
        0.09564f, 0.08729955f, 0.07930804f, 0.07171776f, 0.06458099f, 0.05795001f, 0.05186211f, 0.04628152f,
        0.04115088f, 0.03641283f, 0.03201f, 0.0279172f, 0.0241444f, 0.020687f, 0.0175404f, 0.0147f,
        0.01216179f, 0.00991996f, 0.00796724f, 0.006296346f, 0.0049f, 0.003777173f, 0.00294532f, 0.00242488f,
        0.002236293f, 0.0024f, 0.00292552f, 0.00383656f, 0.00517484f, 0.00698208f, 0.0093f, 0.01214949f,
        0.01553588f, 0.01947752f, 0.02399277f, 0.0291f, 0.03481485f, 0.04112016f, 0.04798504f, 0.05537861f,
        0.06327f, 0.07163501f, 0.08046224f, 0.08973996f, 0.09945645f, 0.1096f, 0.1201674f, 0.1311145f,
        0.1423679f, 0.1538542f, 0.1655f, 0.1772571f, 0.18914f, 0.2011694f, 0.2133658f, 0.2257499f,
        0.2383209f, 0.2510668f, 0.2639922f, 0.2771017f, 0.2904f, 0.3038912f, 0.3175726f, 0.3314384f,
        0.3454828f, 0.3597f, 0.3740839f, 0.3886396f, 0.4033784f, 0.4183115f, 0.4334499f, 0.4487953f,
        0.464336f, 0.480064f, 0.4959713f, 0.5120501f, 0.5282959f, 0.5446916f, 0.5612094f, 0.5778215f,
        0.5945f, 0.6112209f, 0.6279758f, 0.6447602f, 0.6615697f, 0.6784f, 0.6952392f, 0.7120586f,
        0.7288284f, 0.7455188f, 0.7621f, 0.7785432f, 0.7948256f, 0.8109264f, 0.8268248f, 0.8425f,
        0.8579325f, 0.8730816f, 0.8878944f, 0.9023181f, 0.9163f, 0.9297995f, 0.9427984f, 0.9552776f,
        0.9672179f, 0.9786f, 0.9893856f, 0.9995488f, 1.0090892f, 1.0180064f, 1.0263f, 1.0339827f,
        1.040986f, 1.047188f, 1.0524667f, 1.0567f, 1.0597944f, 1.0617992f, 1.0628068f, 1.0629096f,
        1.0622f, 1.0607352f, 1.0584436f, 1.0552244f, 1.0509768f, 1.0456f, 1.0390369f, 1.0313608f,
        1.0226662f, 1.0130477f, 1.0026f, 0.9913675f, 0.9793314f, 0.9664916f, 0.9528479f, 0.9384f,
        0.923194f, 0.907244f, 0.890502f, 0.87292f, 0.8544499f, 0.835084f, 0.814946f, 0.794186f,
        0.772954f, 0.7514f, 0.7295836f, 0.7075888f, 0.6856022f, 0.6638104f, 0.6424f, 0.6215149f,
        0.6011138f, 0.5811052f, 0.5613977f, 0.5419f, 0.5225995f, 0.5035464f, 0.4847436f, 0.4661939f,
        0.4479f, 0.4298613f, 0.412098f, 0.394644f, 0.3775333f, 0.3608f, 0.3444563f, 0.3285168f,
        0.3130192f, 0.2980011f, 0.2835f, 0.2695448f, 0.2561184f, 0.2431896f, 0.2307272f, 0.2187f,
        0.2070971f, 0.1959232f, 0.1851708f, 0.1748323f, 0.1649f, 0.1553667f, 0.14623f, 0.13749f,
        0.1291467f, 0.1212f, 0.1136397f, 0.106465f, 0.09969044f, 0.09333061f, 0.0874f, 0.08190096f,
        0.07680428f, 0.07207712f, 0.06768664f, 0.0636f, 0.05980685f, 0.05628216f, 0.05297104f, 0.04981861f,
        0.04677f, 0.04378405f, 0.04087536f, 0.03807264f, 0.03540461f, 0.0329f, 0.03056419f, 0.02838056f,
        0.02634484f, 0.02445275f, 0.0227f, 0.02108429f, 0.01959988f, 0.01823732f, 0.01698717f, 0.01584f,
        0.01479064f, 0.01383132f, 0.01294868f, 0.0121292f, 0.01135916f, 0.01062935f, 0.009938846f, 0.009288422f,
        0.008678854f, 0.008110916f, 0.007582388f, 0.007088746f, 0.006627313f, 0.006195408f, 0.005790346f, 0.005409826f,
        0.005052583f, 0.004717512f, 0.004403507f, 0.004109457f, 0.003833913f, 0.003575748f, 0.003334342f, 0.003109075f,
        0.002899327f, 0.002704348f, 0.00252302f, 0.002354168f, 0.002196616f, 0.00204919f, 0.00191096f, 0.001781438f,
        0.00166011f, 0.001546459f, 0.001439971f, 0.001340042f, 0.001246275f, 0.001158471f, 0.00107643f, 0.000999949f,
        0.000928736f, 0.000862433f, 0.00080075f, 0.000743396f, 0.000690079f, 0.000640516f, 0.000594502f, 0.000551865f,
        0.000512429f, 0.000476021f, 0.000442454f, 0.000411512f, 0.000382981f, 0.000356649f, 0.000332301f, 0.000309759f,
        0.000288887f, 0.000269539f, 0.000251568f, 0.000234826f, 0.000219171f, 0.000204526f, 0.000190841f, 0.000178065f,
        0.000166151f, 0.000155024f, 0.000144622f, 0.00013491f, 0.000125852f, 0.000117413f, 0.000109552f, 0.000102225f,
        9.53945E-05f, 8.90239E-05f, 8.30753E-05f, 7.75127E-05f, 7.2313E-05f, 6.74578E-05f, 6.29284E-05f, 5.87065E-05f,
        5.47703E-05f, 5.10992E-05f, 4.76765E-05f, 4.44857E-05f, 4.15099E-05f, 3.87332E-05f, 3.6142E-05f, 3.37235E-05f,
        3.14649E-05f, 2.93533E-05f, 2.73757E-05f, 2.55243E-05f, 2.37938E-05f, 2.21787E-05f, 2.06738E-05f, 1.92723E-05f,
        1.79664E-05f, 1.67499E-05f, 1.56165E-05f, 1.45598E-05f, 1.35739E-05f, 1.26544E-05f, 1.17972E-05f, 1.09984E-05f,
        1.0254E-05f, 9.55965E-06f, 8.91204E-06f, 8.30836E-06f, 7.74577E-06f, 7.22146E-06f, 6.73248E-06f, 6.27642E-06f,
        5.8513E-06f, 5.45512E-06f, 5.08587E-06f, 4.74147E-06f, 4.42024E-06f, 4.12078E-06f, 3.84172E-06f, 3.58165E-06f,
        3.33913E-06f, 3.11295E-06f, 2.90212E-06f, 2.70565E-06f, 2.52253E-06f, 2.35173E-06f, 2.19242E-06f, 2.0439E-06f,
        1.9055E-06f, 1.77651E-06f, 1.65622E-06f, 1.54402E-06f, 1.43944E-06f, 1.34198E-06f, 1.25114E-06f
    };

    const float ybar_CIE1931_2deg[] = {
        0.000003917f, 4.39358E-06f, 4.9296E-06f, 5.53214E-06f, 6.20825E-06f, 0.000006965f, 7.81322E-06f, 8.76734E-06f,
        9.83984E-06f, 1.10432E-05f, 0.00001239f, 1.38864E-05f, 1.55573E-05f, 1.7443E-05f, 1.95838E-05f, 0.00002202f,
        2.48397E-05f, 2.80413E-05f, 3.1531E-05f, 3.52152E-05f, 0.000039f, 4.28264E-05f, 4.69146E-05f, 5.15896E-05f,
        5.71764E-05f, 0.000064f, 7.23442E-05f, 8.22122E-05f, 9.35082E-05f, 0.000106136f, 0.00012f, 0.000134984f,
        0.000151492f, 0.000170208f, 0.000191816f, 0.000217f, 0.000246907f, 0.00028124f, 0.00031852f, 0.000357267f,
        0.000396f, 0.000433715f, 0.000473024f, 0.000517876f, 0.000572219f, 0.00064f, 0.00072456f, 0.0008255f,
        0.00094116f, 0.00106988f, 0.00121f, 0.001362091f, 0.001530752f, 0.001720368f, 0.001935323f, 0.00218f,
        0.0024548f, 0.002764f, 0.0031178f, 0.0035264f, 0.004f, 0.00454624f, 0.00515932f, 0.00582928f,
        0.00654616f, 0.0073f, 0.008086507f, 0.00890872f, 0.00976768f, 0.01066443f, 0.0116f, 0.01257317f,
        0.01358272f, 0.01462968f, 0.01571509f, 0.01684f, 0.01800736f, 0.01921448f, 0.02045392f, 0.02171824f,
        0.023f, 0.02429461f, 0.02561024f, 0.02695857f, 0.02835125f, 0.0298f, 0.03131083f, 0.03288368f,
        0.03452112f, 0.03622571f, 0.038f, 0.03984667f, 0.041768f, 0.043766f, 0.04584267f, 0.048f,
        0.05024368f, 0.05257304f, 0.05498056f, 0.05745872f, 0.06f, 0.06260197f, 0.06527752f, 0.06804208f,
        0.07091109f, 0.0739f, 0.077016f, 0.0802664f, 0.0836668f, 0.0872328f, 0.09098f, 0.09491755f,
        0.09904584f, 0.1033674f, 0.1078846f, 0.1126f, 0.117532f, 0.1226744f, 0.1279928f, 0.1334528f,
        0.13902f, 0.1446764f, 0.1504693f, 0.1564619f, 0.1627177f, 0.1693f, 0.1762431f, 0.1835581f,
        0.1912735f, 0.199418f, 0.20802f, 0.2171199f, 0.2267345f, 0.2368571f, 0.2474812f, 0.2586f,
        0.2701849f, 0.2822939f, 0.2950505f, 0.308578f, 0.323f, 0.3384021f, 0.3546858f, 0.3716986f,
        0.3892875f, 0.4073f, 0.4256299f, 0.4443096f, 0.4633944f, 0.4829395f, 0.503f, 0.5235693f,
        0.544512f, 0.56569f, 0.5869653f, 0.6082f, 0.6293456f, 0.6503068f, 0.6708752f, 0.6908424f,
        0.71f, 0.7281852f, 0.7454636f, 0.7619694f, 0.7778368f, 0.7932f, 0.8081104f, 0.8224962f,
        0.8363068f, 0.8494916f, 0.862f, 0.8738108f, 0.8849624f, 0.8954936f, 0.9054432f, 0.9148501f,
        0.9237348f, 0.9320924f, 0.9399226f, 0.9472252f, 0.954f, 0.9602561f, 0.9660074f, 0.9712606f,
        0.9760225f, 0.9803f, 0.9840924f, 0.9874182f, 0.9903128f, 0.9928116f, 0.9949501f, 0.9967108f,
        0.9980983f, 0.999112f, 0.9997482f, 1.0f, 0.9998567f, 0.9993046f, 0.9983255f, 0.9968987f,
        0.995f, 0.9926005f, 0.9897426f, 0.9864444f, 0.9827241f, 0.9786f, 0.9740837f, 0.9691712f,
        0.9638568f, 0.9581349f, 0.952f, 0.9454504f, 0.9384992f, 0.9311628f, 0.9234576f, 0.9154f,
        0.9070064f, 0.8982772f, 0.8892048f, 0.8797816f, 0.87f, 0.8598613f, 0.849392f, 0.838622f,
        0.8275813f, 0.8163f, 0.8047947f, 0.793082f, 0.781192f, 0.7691547f, 0.757f, 0.7447541f,
        0.7324224f, 0.7200036f, 0.7074965f, 0.6949f, 0.6822192f, 0.6694716f, 0.6566744f, 0.6438448f,
        0.631f, 0.6181555f, 0.6053144f, 0.5924756f, 0.5796379f, 0.5668f, 0.5539611f, 0.5411372f,
        0.5283528f, 0.5156323f, 0.503f, 0.4904688f, 0.4780304f, 0.4656776f, 0.4534032f, 0.4412f,
        0.42908f, 0.417036f, 0.405032f, 0.393032f, 0.381f, 0.3689184f, 0.3568272f, 0.3447768f,
        0.3328176f, 0.321f, 0.3093381f, 0.2978504f, 0.2865936f, 0.2756245f, 0.265f, 0.2547632f,
        0.2448896f, 0.2353344f, 0.2260528f, 0.217f, 0.2081616f, 0.1995488f, 0.1911552f, 0.1829744f,
        0.175f, 0.1672235f, 0.1596464f, 0.1522776f, 0.1451259f, 0.1382f, 0.1315003f, 0.1250248f,
        0.1187792f, 0.1127691f, 0.107f, 0.1014762f, 0.09618864f, 0.09112296f, 0.08626485f, 0.0816f,
        0.07712064f, 0.07282552f, 0.06871008f, 0.06476976f, 0.061f, 0.05739621f, 0.05395504f, 0.05067376f,
        0.04754965f, 0.04458f, 0.04175872f, 0.03908496f, 0.03656384f, 0.03420048f, 0.032f, 0.02996261f,
        0.02807664f, 0.02632936f, 0.02470805f, 0.0232f, 0.02180077f, 0.02050112f, 0.01928108f, 0.01812069f,
        0.017f, 0.01590379f, 0.01483718f, 0.01381068f, 0.01283478f, 0.01192f, 0.01106831f, 0.01027339f,
        0.009533311f, 0.008846157f, 0.00821f, 0.007623781f, 0.007085424f, 0.006591476f, 0.006138485f, 0.005723f,
        0.005343059f, 0.004995796f, 0.004676404f, 0.004380075f, 0.004102f, 0.003838453f, 0.003589099f, 0.003354219f,
        0.003134093f, 0.002929f, 0.002738139f, 0.002559876f, 0.002393244f, 0.002237275f, 0.002091f, 0.001953587f,
        0.00182458f, 0.00170358f, 0.001590187f, 0.001484f, 0.001384496f, 0.001291268f, 0.001204092f, 0.001122744f,
        0.001047f, 0.00097659f, 0.000911109f, 0.000850133f, 0.000793238f, 0.00074f, 0.000690083f, 0.00064331f,
        0.000599496f, 0.000558455f, 0.00052f, 0.000483914f, 0.000450053f, 0.000418345f, 0.000388718f, 0.0003611f,
        0.000335384f, 0.00031144f, 0.000289166f, 0.000268454f, 0.0002492f, 0.000231302f, 0.000214686f, 0.000199288f,
        0.000185048f, 0.0001719f, 0.000159778f, 0.000148604f, 0.000138302f, 0.000128793f, 0.00012f, 0.00011186f,
        0.000104322f, 9.73356E-05f, 9.08459E-05f, 0.0000848f, 7.91467E-05f, 0.000073858f, 0.000068916f, 6.43027E-05f,
        0.00006f, 5.59819E-05f, 5.22256E-05f, 4.87184E-05f, 4.54475E-05f, 0.0000424f, 3.9561E-05f, 3.69151E-05f,
        3.44487E-05f, 3.21482E-05f, 0.00003f, 2.79913E-05f, 2.61136E-05f, 2.43602E-05f, 2.27246E-05f, 0.0000212f,
        1.97786E-05f, 1.84529E-05f, 1.72169E-05f, 1.60646E-05f, 0.00001499f, 1.39873E-05f, 1.30516E-05f, 1.21782E-05f,
        1.13625E-05f, 0.0000106f, 9.88588E-06f, 9.2173E-06f, 8.59236E-06f, 8.00913E-06f, 7.4657E-06f, 6.95957E-06f,
        6.488E-06f, 6.0487E-06f, 5.6394E-06f, 5.2578E-06f, 4.90177E-06f, 4.56972E-06f, 4.26019E-06f, 3.97174E-06f,
        3.7029E-06f, 3.45216E-06f, 3.2183E-06f, 3.0003E-06f, 2.79714E-06f, 2.6078E-06f, 2.43122E-06f, 2.26653E-06f,
        2.11301E-06f, 1.96994E-06f, 1.8366E-06f, 1.71223E-06f, 1.59623E-06f, 1.48809E-06f, 1.38731E-06f, 1.2934E-06f,
        1.20582E-06f, 1.12414E-06f, 1.04801E-06f, 9.77058E-07f, 9.1093E-07f, 8.49251E-07f, 7.91721E-07f, 7.3809E-07f,
        6.8811E-07f, 6.4153E-07f, 5.9809E-07f, 5.57575E-07f, 5.19808E-07f, 4.84612E-07f, 4.5181E-07f
    };

    const float zbar_CIE1931_2deg[] = {
        0.0006061f, 0.000680879f, 0.000765146f, 0.000860012f, 0.000966593f, 0.001086f, 0.001220586f, 0.001372729f,
        0.001543579f, 0.001734286f, 0.001946f, 0.002177777f, 0.002435809f, 0.002731953f, 0.003078064f, 0.003486f,
        0.003975227f, 0.00454088f, 0.00515832f, 0.005802907f, 0.006450001f, 0.007083216f, 0.007745488f, 0.008501152f,
        0.009414544f, 0.01054999f, 0.0119658f, 0.01365587f, 0.01558805f, 0.01773015f, 0.02005001f, 0.02251136f,
        0.02520288f, 0.02827972f, 0.03189704f, 0.03621f, 0.04143771f, 0.04750372f, 0.05411988f, 0.06099803f,
        0.06785001f, 0.07448632f, 0.08136156f, 0.08915364f, 0.09854048f, 0.1102f, 0.1246133f, 0.1417017f,
        0.1613035f, 0.1832568f, 0.2074f, 0.2336921f, 0.2626114f, 0.2947746f, 0.3307985f, 0.3713f,
        0.4162091f, 0.4654642f, 0.5196948f, 0.5795303f, 0.6456f, 0.7184838f, 0.7967133f, 0.8778459f,
        0.959439f, 1.0390501f, 1.1153673f, 1.1884971f, 1.2581233f, 1.3239296f, 1.3856f, 1.4426352f,
        1.4948035f, 1.5421903f, 1.5848807f, 1.62296f, 1.6564048f, 1.6852959f, 1.7098745f, 1.7303821f,
        1.74706f, 1.7600446f, 1.7696233f, 1.7762637f, 1.7804334f, 1.7826f, 1.7829682f, 1.7816998f,
        1.7791982f, 1.7758671f, 1.77211f, 1.7682589f, 1.764039f, 1.7589438f, 1.7524663f, 1.7441f,
        1.7335595f, 1.7208581f, 1.7059369f, 1.6887372f, 1.6692f, 1.6475287f, 1.6234127f, 1.5960223f,
        1.564528f, 1.5281f, 1.4861114f, 1.4395215f, 1.3898799f, 1.3387362f, 1.28764f, 1.2374223f,
        1.1878243f, 1.1387611f, 1.090148f, 1.0419f, 0.9941976f, 0.9473473f, 0.9014531f, 0.8566193f,
        0.8129501f, 0.7705173f, 0.7294448f, 0.6899136f, 0.6521049f, 0.6162f, 0.5823286f, 0.5504162f,
        0.5203376f, 0.4919673f, 0.46518f, 0.4399246f, 0.4161836f, 0.3938822f, 0.3729459f, 0.3533f,
        0.3348578f, 0.3175521f, 0.3013375f, 0.2861686f, 0.272f, 0.2588171f, 0.2464838f, 0.2347718f,
        0.2234533f, 0.2123f, 0.2011692f, 0.1901196f, 0.1792254f, 0.1685608f, 0.1582f, 0.1481383f,
        0.1383758f, 0.1289942f, 0.1200751f, 0.1117f, 0.1039048f, 0.09666748f, 0.08998272f, 0.08384531f,
        0.07824999f, 0.07320899f, 0.06867816f, 0.06456784f, 0.06078835f, 0.05725001f, 0.05390435f, 0.05074664f,
        0.04775276f, 0.04489859f, 0.04216f, 0.03950728f, 0.03693564f, 0.03445836f, 0.03208872f, 0.02984f,
        0.02771181f, 0.02569444f, 0.02378716f, 0.02198925f, 0.0203f, 0.01871805f, 0.01724036f, 0.01586364f,
        0.01458461f, 0.0134f, 0.01230723f, 0.01130188f, 0.01037792f, 0.009529306f, 0.008749999f, 0.0080352f,
        0.0073816f, 0.0067854f, 0.0062428f, 0.005749999f, 0.0053036f, 0.0048998f, 0.0045342f, 0.0042024f,
        0.0039f, 0.0036232f, 0.0033706f, 0.0031414f, 0.0029348f, 0.002749999f, 0.0025852f, 0.0024386f,
        0.0023094f, 0.0021968f, 0.0021f, 0.002017733f, 0.0019482f, 0.0018898f, 0.001840933f, 0.0018f,
        0.001766267f, 0.0017378f, 0.0017112f, 0.001683067f, 0.001650001f, 0.001610133f, 0.0015644f, 0.0015136f,
        0.001458533f, 0.0014f, 0.001336667f, 0.00127f, 0.001205f, 0.001146667f, 0.0011f, 0.0010688f,
        0.0010494f, 0.0010356f, 0.0010212f, 0.001f, 0.00096864f, 0.00092992f, 0.00088688f, 0.00084256f,
        0.0008f, 0.00076096f, 0.00072368f, 0.00068592f, 0.00064544f, 0.0006f, 0.000547867f, 0.0004916f,
        0.0004354f, 0.000383467f, 0.00034f, 0.000307253f, 0.00028316f, 0.00026544f, 0.000251813f, 0.00024f,
        0.000229547f, 0.00022064f, 0.00021196f, 0.000202187f, 0.00019f, 0.000174213f, 0.00015564f, 0.00013596f,
        0.000116853f, 0.0001f, 8.61333E-05f, 0.0000746f, 0.000065f, 5.69333E-05f, 5E-05f, 0.00004416f,
        0.00003948f, 0.00003572f, 0.00003264f, 0.00003f, 2.76533E-05f, 0.00002556f, 0.00002364f, 2.18133E-05f,
        0.00002f, 1.81333E-05f, 0.0000162f, 0.0000142f, 1.21333E-05f, 0.00001f, 7.73333E-06f, 0.0000054f,
        0.0000032f, 1.33333E-06f, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0
    };

    float integralCMF;

    static bool s_initialized = false;

    void initializeColorSystem() {
        if (!s_initialized) {
            UpsampledSpectrumTemplate<float, NumSpectralSamples>::initialize();
            DiscretizedSpectrumTemplate<float, NumStrataForStorage>::initialize();

            CompensatedSum<float> cum(0);
            for (int i = 1; i < NumCMFSamples; ++i)
                cum += (ybarReferenceValues[i - 1] + ybarReferenceValues[i]) * 1 * 0.5f;
            integralCMF = cum;

            s_initialized = true;
        }
    }

    void finalizeColorSystem() {
        if (s_initialized) {
            s_initialized = false;
        }
    }
}